<!DOCTYPE html>

{% set lc0 = "Unsuitable for any use." %}
{% set lc15 = "Suitable for non-text contrast on disabled elements." %}
{% set lc30 = "Suitable for text on disabled elements and incidental text (e.g. copyright notice)." %}
{% set lc45 = "Suitable for logotypes and other very short text." %}
{% set lc60 = "Suitable for non-text contrast and larger text (e.g. headings)." %}
{% set lc75 = "Suitable for prosaic text above â‰…18px." %}
{% set lc90 = "Suitable for proasic text above â‰…16px." %}

{% macro _cell(fg, bg) %}
  {% set score = apcaScore(fg, bg) %}
  {%- if fg == bg %}
    <td class="cell empty" aria-hidden="true"></td>
  {%- else %}
    <td class="cell swatch" style="--fg: {{ fg }}; --bg: {{ bg }};">
      <div>
        <span aria-hidden="true" class="type-sample">Aa</span>
        {{ _score(score) }}
      </div>
    </td>
  {%- endif %}
{% endmacro %}

{% macro _score(score) %}
  {%- set score = score | abs -%}
  {%- set classes = 'apca-score' -%}
  
  {%- if score < 15 %}
    {% set title = lc0 %}
    {% set classes = classes + ' apca-score--unsuitable' %}
  {%- elif score >= 15 and score < 30 %}
    {% set title = lc15 %}
    {% set classes = classes + ' apca-score--disabled' %}
  {%- elif score >= 30 and score < 45 %}
    {% set title = lc30 %}
    {% set classes = classes + ' apca-score--incidental' %}
  {%- elif score >= 45 and score < 60 %}
    {% set title = lc45 %}
    {% set classes = classes + ' apca-score--logos' %}
  {%- elif score >= 60 and score < 75 %}
    {% set title = lc60 %}
    {% set classes = classes + ' apca-score--non-text' %}
  {%- elif score >= 75 and score < 90 %}
    {% set title = lc75 %}
    {% set classes = classes + ' apca-score--body' %}
  {%- elif score >= 90 %}
    {% set title = lc90 %}
    {% set classes = classes + ' apca-score--body-small' %}
  {%- endif %}
  
  <span class="{{ classes }}" title="{{ title }}">{{ score }}</span>
{% endmacro %}

{% macro _size(size) %}
  {%- if size == 777 %}
    ðŸš«
  {%- else %}
    {{ (size * 1.05) | toFixed(1) }}px
  {%- endif %}
{% endmacro %}

<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>GOV.UK Frontend APCA calculations</title>
  <link rel="stylesheet" href="https://files.beeps.gay/one-stylesheet/one-stylesheet.css">
  <style>
    :root {
      --grid-max-width: 90%;
      --font-body: system-ui, Helvetica, sans-serif;
      --color-accent: currentcolor;
    }
    .scroller {
      overflow: auto;
    }
    table { 
      inline-size: auto;
      table-layout: fixed; 
    }
    table th, table td {
      border: 1px solid;
    }
    table thead th {
      border-block-start: none;
      padding-inline: var(--space-1);
    }
    table tr th:first-child {
      border-inline-start: none;
    }
    table tbody td,
    table td:last-child {
      padding: var(--space-1);
    }
    code {
      font-size: smaller;
    }
    .cell.empty {
      background-image: linear-gradient(45deg, transparent 50%, currentcolor 50%, currentcolor calc(50% + 1px), transparent calc(50% + 1px));
    }
    .cell.swatch {
      background-color: var(--bg);
    }
    .cell div {
      display: flex;
      flex-direction: column;
      inline-size: 6rem;
      block-size: 6rem;
    }
    .type-sample {
      color: var(--fg);
      font-size: 2.2em;
      line-height: 1;
    }
    .apca-score { 
      display: inline-block;
      align-self: flex-end;
      margin-top: auto;
      padding-inline: var(--space-1);
      color: #fff;
      text-shadow: 0 0 1px black;
      font-size: small;
      font-weight: bold;
      font-variant-numeric: tabular-nums;
      text-align: right;
    }
    .apca-score--unsuitable {
      background-color: #000000;
    }
    .apca-score--disabled {
      background-color: #15240B;
    }
    .apca-score--incidental {
      background-color: #294715;
    }
    .apca-score--logos {
      background-color: #3E6B20;
    }
    .apca-score--non-text {
      background-color: #528E2A;
    }
    .apca-score--body {
      background-color: #67B235;
    }
    .apca-score--body-small {
      background-color: #7BD53F;
    }
  </style>
</head>
<body>

  <h1>GOV.UK Frontend <abbr title="Accessible Perceptual Contrast Algorithm">APCA</abbr> calculations</h1>
  
  <p>APCA's rough boundaries:</p>
  <ul>
    <li>Lc. <15 â€” {{ lc0 }}</li>
    <li>Lc. 15 â€” {{ lc15 }}</li>
    <li>Lc. 30 â€” {{ lc30 }}</li>
    <li>Lc. 45 â€” {{ lc45 }}</li>
    <li>Lc. 60 â€” {{ lc60 }}</li>
    <li>Lc. 75 â€” {{ lc75 }}</li>
    <li>Lc. 90+ â€” {{ lc90 }}</li>
  </ul>
  
  <h2>Colour palette scores</h2>
  <p>APCA scores for each of the colour combinations possible with the GOV.UK Frontend palette.</p>

  <div class="scroller">
    <table>
      <thead>
        <tr>
          <th aria-hidden="true"></th>
          {%- for fg in colours.full %}
            <th scope="col">{{ fg.label }}<br><code>{{ fg.color }}</code></th>
          {%- endfor %}
        </tr>
      </thead>
      <tbody>
        {%- for bg in colours.full %}
        <tr>
          <th scope="row">{{ bg.label }}<br><code>{{ bg.color }}</code></th>
          {%- for fg in colours.full %}
            {{ _cell(fg.color, bg.color) }}
          {%- endfor %}
        </tr>
        {%- endfor %}
      </tbody>
    </table>
  </div>
  
  
  <h2>Minimum font size and weights</h2>
  <p>GDS Transport has a reference ratio of 1.05, due to having a slightly smaller x-height than the reference typeface (Helvetica). This means that the minimum font sizes needed are 0.05Ã— higher than their reference equivalents, rounded up. 
  <p>As we only use Transport in 400 and 700 weights, and these are very close to their Helvetica equivalents, no weight offset has been applied.</p>
  
  <div class="scroller">
    <table>
      <thead>
        <tr>
          <th scope="col"></th>
          <th scope="col" style="font-weight: 100;">100</th>
          <th scope="col" style="font-weight: 200;">200</th>
          <th scope="col" style="font-weight: 300;">300</th>
          <th scope="col" style="font-weight: 400;">400</th>
          <th scope="col" style="font-weight: 500;">500</th>
          <th scope="col" style="font-weight: 600;">600</th>
          <th scope="col" style="font-weight: 700;">700</th>
          <th scope="col" style="font-weight: 800;">800</th>
          <th scope="col" style="font-weight: 900;">900</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <th scope="row">Lc. 15</th>
          {%- for col in fontSizeMinimum(15) %}
          <td>{{ _size(col) }}</td>
          {%- endfor%}
        </tr>
        <tr>
          <th scope="row">Lc. 30</th>
          {%- for col in fontSizeMinimum(30) %}
          <td>{{ _size(col) }}</td>
          {%- endfor%}
        </tr>
        <tr>
          <th scope="row">Lc. 45</th>
          {%- for col in fontSizeMinimum(45) %}
          <td>{{ _size(col) }}</td>
          {%- endfor%}
        </tr>
        <tr>
          <th scope="row">Lc. 60</th>
          {%- for col in fontSizeMinimum(60) %}
          <td>{{ _size(col) }}</td>
          {%- endfor%}
        </tr>
        <tr>
          <th scope="row">Lc. 75</th>
          {%- for col in fontSizeMinimum(75) %}
          <td>{{ _size(col) }}</td>
          {%- endfor%}
        </tr>
        <tr>
          <th scope="row">Lc. 90</th>
          {%- for col in fontSizeMinimum(90) %}
          <td>{{ _size(col) }}</td>
          {%- endfor%}
        </tr>
        <tr>
          <th scope="row">Lc. 100</th>
          {%- for col in fontSizeMinimum(100) %}
          <td>{{ _size(col) }}</td>
          {%- endfor%}
        </tr>
      </tbody>
    </table>
  </div>

  
</body>
</html>